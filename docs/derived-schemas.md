# Derived Schemas


> **Note:** This will be retired in 0.9.0

## Overview

The GHGA Metadata Schema, as represented in `src/schema/ghga.yaml`, is the source of
truth for how the different metadata entities are linked and represented.

But there can be one or more scenarios where a derived version of the GHGA Metadata
Schema may be required for specific use-cases.

For posterity, these use-cases are documented below.

## Use Cases

### Use Case 1: Schema for creation of metadata entities

This use case is pertaining to a data submission scenario where a user/data submitter would provide information about different metadata entities like `study`, `experiment`, `sample`, etc.

According to the GHGA Metadata Schema, for entities of type `study`, the following is true:

- `study` must have a value for the `id` slot
- `study` optionally can have a value for `alias` slot
- `study` optionally can have a value for `creation date` slot
- `study` optionally can have a value for `update date` slot


Now, conceptually this is correct. But in practice these constraints are difficult
to put to use when handing metadata submission.

At the time of data submission, we want the following to be true:

- `study` must not have a value for the `id` slot; This is assigned internally as part of the submission process
- `study` must have a value for `alias` slot; This is the identifier that is used internally to link metadata entities during the submission process
- `study` must not have a value for `creation date` slot; This is assigned internally as part of the submission process
- `study` must not have a value for `update date` slot; This is assigned internally as part of the submission process


There are two ways to manage this difference:

- Have another version of GHGA Metadata Schema but for Submission; This version is curated and managed alongside the main GHGA Metadata Schema
- Automatically derive a version of the GHGA Metadata Schema, solely for the specific purpose of Submission, from the main GHGA Metadata Schema

We choose the latter, to reduce inconsistencies and to reduce the burden of curating more than one source of truth for the GHGA Metadata Schema.

All derived schemas are located at `artifacts/derived_schema` and generated each time the main `src/schema/ghga.yaml` changes.

The autogenerated schema for the use case of Submission is located at `artifacts/derived_schema/creation`.

- `artifacts/derived_schema/creation/ghga_creation.yaml` - the derived schema YAML, generated by `scripts/generate_creation_schema.py`
- `artifacts/derived_schema/creation/ghga_creation.py` - Python dataclasses generated from `ghga_creation.yaml`
- `artifacts/derived_schema/creation/ghga_creation_models.py` - Pydantic models generated from `ghga_creation.yaml`
- `artifacts/derived_schema/creation/ghga_creation.schema.json` - JSON Schema generated from `ghga_creation.yaml`

Expected consumers of this derived schema:

- [Metadata Repository Service](https://github.com/ghga-de/metadata-repository-service)
- [Metadata Transpiler Service](https://github.com/ghga-de/metadata-transpiler-service)

